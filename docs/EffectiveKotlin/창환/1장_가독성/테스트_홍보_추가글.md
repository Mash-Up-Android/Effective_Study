# 테스트 관련 장점을 설명한 문서입니다.

## 서론

테스트는 좋은 도구이며 동반자라 생각하여 테스트 도입과 거부감을 없애기 위해 글을 써보았습니다.  
일반적으로 테스트에 대한 의견은 매우 분분하며 각각의 주장이 첨예하게 갈립니다.  
앞으로 작성하게 될 테스트 관련 글들은 저의 주관이 굉장히 강하게 들어가 있을 예정이므로 테스트에 관한 하나의 참고 문서 정도로 봐주셨으면 좋겠습니다.  
그럼 시작해보도록 하겠습니다.  


<div align="center">
  <img src="https://github.com/user-attachments/assets/2043d6d1-8f15-467a-a7f7-623c9526f85b" width="400"/>
</div>


## 테스트의 이점은?

근시안적인 시각에서 테스트는 생산성을 떨어트린다고 볼 수 있습니다.  
하지만 멀리 내다본다면 테스트는 오히려 생산성을 굉장히 높일 수 있는 도구 중 하나입니다.  
테스트를 짜면서 제가 피부로 느꼈던 장점을 서술해 보겠습니다.  


### 1. 기능 목록을 선제적으로 뽑게되어 작업중 누락되는 기능이 현저하게 줄어든다.

사실상 TDD 로 작업할시 느낄 수 있는 장점 → 도메인로직 작성시 특히 강력합니다.  
기능목록이 정의 되었을시 리펙터링에도 유용합니다.  

회사에서 이런 경우의 수를 많이 볼 수 있는데 기획서 등에서 약간의 변경점이 있는 기획이라면 대부분이 기존 기능과 동일하게 유지해달라는 요구 사항이 많습니다.  
하지만 이미 그 기능은 오래전 만들어졌고 오랜기간 유지보수 되어왔으며 여러사람의 손을 탄 경우가 대부분입니다.  
이러한 경우 히스토리를 파악하기 힘들며 어떤것이 정상동작인지 판단하기 힘들 경우 또한 많습니다.  

이럴때 정확한 기능목록이 개발단에 정의 되어있다면 업무 효율을 높일 수 있는 강력한 도구가 될 것 입니다.  


### 2. 그 자체로 강력한 문서가 될 수 있다.

테스트 함수명의 경우 한글로 작성하는 경우가 많아 테스트를 보고 기능을 파악하는데 도움이 되는 경우가 많습니다.


### 3.직관적이며 유지보수가 강제되는 주석이 될 수 있다.

CI가 적용 되어있는 환경의 경우 테스트를 항상 통과해야만 하는 환경이 강제됩니다.  

즉 테스트 통과를 강제할 수 있다는 것입니다.  
이는 객체 혹은 코드를 설계할때 타인에게 꼭 읽을수 밖에없는 설명서를 제공하는것과 같습니다.  
ex) 테스트를 잘 설계한다면 추후 코드 유지보수시 의도를 벗어날경우 테스트가 깨지는것으로 경고를 줄 수 있습니다.  


### 4. 아키텍처를 바라보는 시각이 열린다.

클린코드, 클린아키텍처 등 많은 아키텍처 혹은 아키텍처 패턴이 테스트를 염두해두고 설계한 부분이 많습니다.  
테스트를 진행하며 의미없이 아키텍처를 따라하는것이 아닌 왜 아키텍처가 이렇게 발전한건지 느낄 수 있게됩니다.  

만약 테스트가 없는 환경이라면 그만큼 아키텍처 패턴을 적용하며 발생하는 테스트를 위한 보일러플레이트 부분을 조정할 수 있는 시야를 제공할 것입니다.(유연하게 아키텍처 패턴을 바라볼수 있는 시야 제공)  

예시로 유명한 책들인 클린코드, 클린아키텍처에서 제가 가장 체감한 항목 두가지를 들어보겠습니다. 

#### [클린 코드]

클린코드에서는 함수를 잘게 쪼개고 인자를 줄이려고 노력하라는 내용이 등장합니다.

이는 테스트성을 높이기 위한 부분도 큰데 테스트를 진행하지 전까지는 왜 함수분리, 클래스분리가 중요한지 감이 오지 않습니다.

하지만 크기가 큰 함수, 여러 동작이 복합적으로 작용하는 함수(각각의 세부기능들이 함수분리 되지않고 테스트 또한 되지 않은), 테스트를 위해 mocking이 필요한 여러객체가 복합적으로 작용하는 함수 등을 한번만이라도 테스트 해보면 왜 그렇게 함수분리 클래스분리를 외치는지 한번에 느낄 수 있습니다.

하지만 무지성으로 함수 분리 클래스 분리를 하는것이 올바른 것일까요?

클린코드에서 좋다고 하니까, 테스트를 하는데는 작은 단위가 좋으니까 라는 이유로 함수분리를 강박적으로 하다보면 느끼는점이 하나있습니다. 
코드를 추후에 읽을때 너무 가독성이 떨어지는 경우가 있습니다.  

결론적으로 객체지향을 통해 테스트성을 확보하려 한다면 객체의 역할과 책임을 단위를 적절하게 쪼개며 
응집도는 높히고 결합도는 낮추는 상황을 만들어야합니다.(이상적인 객체가 테스트하기도 쉬워집니다)

또한 객체, 함수를 분리해내는 이유가 테스트가 되기도 합니다.  
ex) private를 테스트하고 싶어지는 경우, 테스트 하기 어려운 영역을 분리해내고 싶은 경우

이러한 내용들을 테스트를 직접 짜보기 전까지는 체감하지 못하였고 공감도 하지 못하였습니다.

물론 이미 여러 경험을 하신 시니어 혹은 경력자 분들에게는 당연한 이야기를 저렇게 장황하게 하나 느끼실수 있겠지만

신입 개발자인 제 입장에서 그냥 좋다고 읽어본 책인 클린코드에서 시켜서 할뿐 테스트를 하기전까지 코드의 분리에 대한 진정한 의미를 알지 못하고 그저 기계적으로 분리하는 함정에 빠졌었습니다. 

이러한 함정에 빠지지 않기위해서라도 테스트는 한번쯤 접해봐야하는 항목이라고 생각합니다.


#### [클린 아키텍처]

도메인을 특정기술이나 프레임워크의 의존 없이 구성하라는 이유는 참 여러가지가 있을것입니다.  

이 이유 중 큰축을 담당하는 부분이 테스트의 용이성 입니다.  

저는 안드로이드 개발자이기 때문에 안드로이드를 예시로 들어보겠습니다.  

도메인을 레이어로 명확히 구분하여 침범할 수 없는 영역을 구성하면 이는 순수 코틀린 모듈화가 가능합니다.  
(안드로이드 모듈도 상관 없긴 하지만 구성 자체가 순수 코틀린이라는 것이 중요합니다.)

이렇게 구성하게 된다면 핵심 도메인 로직을 Junit을 통해 엄청 빠르게 테스트가 가능합니다.   
→ 컴퓨팅 파워도 크게 필요하지 않게됩니다.(아주 간단하고 행복하게 테스트 할 수 있게 되죠)  

하지만 안드로이드 프레임워크가 묻기 시작한다면 계측 테스트를 진행해야하고 이는 에뮬을 돌려  엄청 느리고 컴퓨팅 파워가 많이 필요한 테스트가 되든 혹은 Robolectric을 이용하여 우회하든 많은 비용이 드는 작업이 수반됩니다.  

하지만 테스트를 진행하지 않는다? 그렇다면 아키텍처에서 테스트로 인하여 제한하고있던 부분의 리미트를 풀어버릴 수 있습니다.  
(이런 리미트를 풀어버리는게 좋은지는 모르겠지만 당장의 생산성은 많이 올라갑니다.)  

사실상 아키텍처는 어떠한 장점을 얻기위해 코드에 제약을 거는 것과 다름이 없다고 생각합니다.  

즉 필연적으로 보일러 플레이트 코드 혹은 특이한 구조를 동반합니다.  
하지만 실험적인 프로젝트라 빠른 생산성이 우선되어 테스트를 진행하지 않을거라면 아키텍처 패턴 중 테스트성을 위한 부분들은 과감히 제거하며 족쇄를 풀고 일단 생산성을 우선하여 코딩하는것도 하나의 방법 아닐까라는 생각입니다.  
(유저를 모으는게 우선이니)

추가 설명: 아키텍처가 필요없다는게 아닙니다. 아키텍처는 여러가지 장점이 있기 때문에 우리의 동반자입니다.
하지만 테스트를 위해서 희생하였던 부분 만큼은 테스트가 없다면 굳이 차용할 필요가 없을수 있다는 뜻입니다.


### 5. 문제범위를 한정 할 수 있다.

테스트를 작성하게 된다면 대부분 기능을 잘게 쪼개서 함수화를 합니다.
이렇게 기능을 구성하며 각각 작은 단위의 기능을 테스트를 통해 정상동작을 확정 할 수 있습니다.

즉 큰 로직을 구성할때 문제가 생긴다면 테스트를 통하여 확인하지 않은 각 로직간의 상호작용에 문제가 있는것으로 한정하여 로직을 작성하기 편해집니다.

### 6. 심적 안정감을 가져다 준다.

가장 중요한 의미 중 하나라고 생각되기도 하는데 눈으로 결과물을 본다는것은 개발자 입장에서 업무를 수행할 때 자신감을 불어넣어 줍니다.

QA, 기획팀에서 문의가 들어왔을떄 본인 로직에 의심을 가지고 한번 확인한다고 하며 프로덕션 코드에 로그를 마구 찍어보신 경험이 있으신가요?   
이로 인해 뇌가 컨텍스트 스위칭 하는 비용으로 하루를 날려보신 경험이 있으신가요?

테스트를 짜게된다면 그냥 딸깍 실행 버튼 만으로도 내가 잘못되지 않았음을 증명할 수 있고 테스트 케이스 또한 쉽게 쉽게 추가할 수 있습니다.  
이를 통해 업무 효율이 높아지는 경험을 할 수 있습니다.


## 결론

이 글에 서술하지는 않았지만 이외에도 정말 많은 테스트의 이점은 존재합니다.

물론 단점이 존재하지 않는것은 아닙니다.(단기적인 생산성 하락)

업무에 있어서 모든 일은 필요에 의해서 움직이는게 맞다고 생각합니다.   
또한 현재 업무나 상황에 따라 필요한 범위를 한정하는 것도 중요합니다.

저의 개인적인 생각으로는 UI테스트를 짜가면서 생산성을 떨어트리는 행위의 경우 좋지 못하다고 생각합니다.  
(사견입니다. UI테스트 또한 정말 필요한 경우도 있다고 생각합니다.)   
하지만 단위테스트의 경우 짜는데 들이는 시간보다 얻는 이득이 더 많다고 생각합니다.

이러한 상황에 맞추어서 본인의 프로젝트, 상황을 잘 살펴보아 필요한 테스트만 취사선택 한다면 정말 이상적인 그림을 만들 수 있지 않을까 라는 생각이 듭니다.

마지막으로 개인적인 추천으로는 객체지향과 관심사 분리를 잘하여 순수 코틀린로직에 대한 단위테스트 테스트 커버리지를 올리는 방향이 제일 좋다고 생각합니다.

