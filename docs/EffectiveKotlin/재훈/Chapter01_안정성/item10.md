# 10. 단위 테스트를 만들어라

---

---

# 개요

코드를 안전하게 만드는 가장 궁극적인 방법은 다양한 종류의 테스트를 하는 것

이러한 종류의 테스트는 개발자 관점에서 애플리케이션 내부적으로 올바르게 작동하는지 확인하는 게 아니라, 사용자 관점에서 애플리케이션 외부적으로 제대로 작동하는지 확인하는 게 목표임

일반적으로 대부분의 관리자는 이러한 테스만 인지함

이런 테스트는 개발자에게 유용하지만 충분하진 않음

이것만으로는 해당 요소가 올바르게 작동한다는 것을 완전하게 보증할 수는 없음

또한 개발 시점에서 빠른 피드백을 받을 수 없음

이러한 문제를 해결하려면, 단위 테스트(unit test)가 필요함

단위 테스트는 개발자가 작성하며, 개발자에게 유용함

단위 테스트는 일반적으로 다음과 같은 내용을 확인함

- 일반적인 유스 케이스(happy path) : 요소가 사용될 거라고 예상되는 일반적인 방법을 테스트함. 예를 들어 앞의 코드처럼 함수로 간단한 숫자 몇 개를 테스트함
- 일반적인 오류 케이스와 잠재적인 문제 : 제대로 동작하지 않을 거라고 예상되는 일반적인 부분, 과거에 문제가 있었던 부분 등을 테스트함
- edge case와 잘못된 아규먼트 : `Int`의 경우 `Int.MAX_VALUE`를 사용하는 경우, nullable의 경우 ‘null’ 또는 ‘null 값으로 채워진 객체’를 쓰는 경우를 의미함. 또한 피보나치 수는 양의 정수로만 구할 수 있음. 음의 정수 등을 넣으면 아규먼트 자체가 잘못된 것임

단위 테스트는 개발자가 만들고 있는 요소가 제대로 동작하는지 빠르게 피드백 해주므로 개발하는 동안 큰 도움됨

테스트는 계속 축적되므로 회귀 테스트(기존 누적된 테케를 기반으로 전체 또는 부분을 반복적으로 테스트)도 쉬움

또한 수동 테스트하기 어려운 것들도 확인 가능

TDD(Test Driven Development)라는 접근 방식도 있음

TDD는 개발 전에 테스트를 먼저 작성하고, 테스트를 통과시키는 것을 목적으로 하나하나 구현해 가는 방식

단위 테스트의 장점

- 테스트가 잘 된 요소는 신뢰할 수 있음
    
    ⇒ 요소를 신뢰할 수 있으므로 요소를 활용한 작업에 자신감이 생김
    
- 테스트가 잘 만들어져 있다면 리팩토링하는 게 두렵지 않음
    
    ⇒ 테스트가 있으므로 리팩토링했을 때 버그가 생기는지 쉽게 확인 가능. 따라서 테스트를 잘 만든 프로그램은 코드가 점점 발전함. 반면 테스트가 없으면 실수로 오류를 일으킬 수도 있다는 생각에 레거시 코드를 수정하려고 만지는 걸 두려워하게 됨
    
- 수동 테스트하는 것보다 단위 테스트로 확인하는 게 빠름
    
    ⇒ 빠른 속도의 피드백 루프(코드를 작성하고 테스트하고를 반복하는 것)가 만들어지므로, 개발의 전체적인 속도가 빨라지고 재밌음. 또한 버그를 빨리 찾을 수 있어 버그 수정 비용도 줄어듦
    

단위 테스트의 단점

- 단위 테스트를 만드는 데 시간이 걸림
    
    ⇒ 다만 장기적으로 좋은 단위 테스트는 디버깅 시간과 버그를 찾는 데 소모되는 시간을 줄여줌. 또한 단위 테스트가 수동 테스트 또는 다른 종류의 테스트보다 훨씬 빨르므로 시간이 절약됨
    
- 테스트를 활용할 수 있게 코드를 조정해야 함
    
    ⇒ 변경하기 어렵지만 이런 변경을 통해서 잘 정립된 아키텍처를 쓰는 게 강제됨
    
- 좋은 단위 테스트를 만드는 작업이 꽤 어려움
    
    ⇒ 남은 개발 과정에 대한 확실한 이해가 필요함. 잘못 만들어진 단위 테스트는 득보다 실이 큼. 단위 테스트를 제대로 하려면, 올바르게 단위 테스트를 하는 방법을 배워야 함. 소프트웨어 테스팅 또는 TDD 관련 내용을 이해해야 함
    

숙련된 코틀린 개발자가 되려면, 단위 테스트 관련 기술을 습득하고, 중요한 코드라고 할 수 있는 다음과 같은 부분에 대해 단위 테스트하는 방법을 알고 있어야 함

- 복잡한 부분
- 계속 수정이 일어나고 리팩토링이 일어날 수 있는 부분
- 비즈니스 로직 부분
- 공용 API 부분
- 문제가 자주 발생하는 부분
- 수정해야 하는 프로덕션 버그(프로덕션 환경에서 발생하는 버그)

---

# 정리

가장 중요한 것은 애플리케이션이 진짜로 올바르게 동작하는지 확인하는 것 → 이것이 테스트

테스트 중에서 개발 과정에서 가장 효율적으로 활용할 수 있는 테스트는 바로 단위 테스트임

비즈니스 애플리케이션 등에서는 최소한 몇 개라도 단위 테스트가 꼭 필요함

---